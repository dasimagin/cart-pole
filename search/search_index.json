{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Overview","text":"<p>CartPole is a personal research project aimed at learning modern RL applicable to robotics. The environment is a variation of the classic control problem, where a pole is attached by a joint to a cart that moves along a single axis. A motor drives the cart, with acceleration serving as the control input. The objective is to swing up the pole and keep it balanced in the unstable upright position.</p> <p></p> <p>Some of the key technology and design choices behind this project:</p> <ol> <li>[Bazel] Unified build and dependency system.</li> <li>[MkDocs] Ccomprehensive docs with extensive use of <code>LaTeX</code>.</li> <li>[Pico2] Simple microcontroller with a C++ SDK.</li> <li>[JAX] Modern and efficient pure RL control</li> </ol>"},{"location":"firmware/","title":"Firmware","text":"<p>To flash the microcontroller, hold down <code>BOOTSEL</code> and connect the device via USB. Then run:</p> <pre><code>bazel run //firmware:flash\n</code></pre> <p>If you only want to verify that the project builds successfully:</p> <pre><code>bazel build //firmware:elf\n</code></pre>"},{"location":"model/","title":"Model","text":""},{"location":"model/#dynamics","title":"Dynamics","text":"<p>A cart with mass \\(m_c\\) moves along the \\(x\\)-axis, so its center \\(C\\) has coordinates \\((x, 0)^T\\). A pole with mass \\(m_p\\) is attached to the cart with a hinge at point \\(C\\), and rotates around with viscous friction. The pole's center of mass is at \\(P\\), moment of inertia is \\(I_p\\). The angle of rotation is denoted as \\(\\theta\\), measured counterclockwise from the axis \\(-y\\). A force \\(f_x\\) is applied to the cart and the force of gravity \\(g\\) acts on the pole.</p>    ![CartPole](svg/cart_pole.svg){width=\"75%\"}  \\[ \\begin{align}     &amp; C = \\begin{pmatrix}         x \\\\ 0     \\end{pmatrix}     &amp;&amp; \\dot{C} = \\begin{pmatrix}         \\dot{x} \\\\ 0     \\end{pmatrix} \\\\     &amp; P = \\begin{pmatrix}         x + l \\sin \\theta \\\\ - l \\cos \\theta     \\end{pmatrix}     &amp;&amp; \\dot{P} = \\begin{pmatrix}         \\dot{x} + l \\dot{\\theta} \\cos \\theta \\\\ l \\dot{\\theta} \\sin \\theta     \\end{pmatrix} \\end{align} \\] <p>The kinetic energy of the cart is</p> \\[ \\begin{align}     T_c = \\frac{1}{2} m_c \\begin{Vmatrix}         \\dot{C}     \\end{Vmatrix}_2^2 = \\frac{1}{2} m_c \\dot{x}^2. \\end{align} \\] <p>As a result energy of the whole system is following</p> \\[ \\begin{align}     T &amp; = T_c + T_p = \\frac{1}{2} \\dot{x}^2 (m_c + m_p) + m_p \\dot{x} l \\dot{\\theta} \\cos \\theta             + \\frac{1}{2} \\dot{\\theta}^2 \\left( m_p l^2  + I_p \\right); \\\\     U &amp; = \\underbrace{U_c}_{0} + U_p = -m_p gl \\cos \\theta. \\end{align} \\] <p>To find the dynamics of system, let's use the Euler-Lagrange differential equation, where \\(L = T - U\\), \\(q = (x, \\theta)^T\\) and \\(Q\\) is the generalized force. In our case, we have deal with two forces: motor force \\(f_x\\) and viscous friction \\(f_{\\theta}(\\theta, \\dot{\\theta}) = -\\mu \\dot{\\theta}\\).</p> \\[ \\begin{align}     Q &amp;= \\frac{d}{dt} \\frac{dL}{d\\dot{q}} - \\frac{dL}{dq} = \\begin{pmatrix} f_x \\\\ f_{\\theta} \\end{pmatrix} \\end{align} \\] <p>Motion equations</p> \\[ \\begin{align}     m_p \\ddot{x} l \\cos \\theta + \\ddot{\\theta} \\left(m_p l^2 + I_p\\right) + m_p g l \\sin \\theta &amp;= f_{\\theta}(\\theta, \\dot{\\theta}) \\\\     \\ddot{x}(m_c + m_p) + m_p l \\ddot{\\theta} \\cos \\theta - m_p l \\dot{\\theta}^2 \\sin \\theta &amp;= f_{x}. \\end{align} \\] Derivation \\[ \\begin{equation}     L = \\frac{1}{2} \\dot{x}^2 (m_c + m_p) + m_p \\dot{x} l \\dot{\\theta} \\cos \\theta +             \\frac{1}{2} \\dot{\\theta}^2 \\left( m_p l^2  + I_p \\right) + m_p gl \\cos \\theta. \\end{equation} \\] \\[ \\begin{align}     \\frac{dL}{d\\theta} &amp; = - m_p \\dot{x} l \\dot{\\theta} \\sin \\theta - m_p gl \\sin \\theta \\\\     \\frac{dL}{d\\dot{\\theta}} &amp; = m_p \\dot{x} l \\cos \\theta + \\left(m_p l^2 + I_p\\right) \\dot{\\theta} \\\\     \\frac{d}{dt} \\frac{dL}{d\\dot{\\theta}} &amp; =         m_p \\ddot{x} l \\cos \\theta - m_p  \\dot{x} l \\dot{\\theta} \\sin \\theta + \\left(m_p l^2 + I_p\\right) \\ddot{\\theta}  \\\\     \\frac{d}{dt} \\frac{dL}{d\\dot{\\theta}} - \\frac{dL}{d\\theta} &amp; =             m_p \\ddot{x} l \\cos \\theta + \\left(m_p l^2 + I_p\\right) \\ddot{\\theta} + m_p g l \\sin \\theta \\\\ \\end{align} \\] \\[ \\begin{align}     \\frac{dL}{dx} &amp; = 0 \\\\     \\frac{dL}{d\\dot{x}} &amp; = (m_c + m_p) \\dot{x} + m_p l \\dot{\\theta} \\cos \\theta \\\\     \\frac{d}{dt} \\frac{dL}{d\\dot{x}} &amp; =             (m_c + m_p) \\ddot{x} + m_p l \\ddot{\\theta} \\cos \\theta - m_p l \\dot{\\theta}^2 \\sin \\theta \\\\     \\frac{d}{dt} \\frac{dL}{d\\dot{x}} - \\frac{dL}{dx} &amp; =         (m_c + m_p) \\ddot{x} + m_p l \\ddot{\\theta} \\cos \\theta - m_p l \\dot{\\theta}^2 \\sin \\theta. \\\\ \\end{align} \\]"},{"location":"model/#acceleration-control","title":"Acceleration control","text":"<p>Let's make the assumption that the motor can generate any force necessary for the cart to reach acceleration in \\([-a, a]\\) on a fixed cart velocity range. This fact allows us to consider the cart acceleration as a control input and significantly simplify the equations of motion</p> \\[ \\begin{align}     \\left(m_p l^2 + I_p\\right) \\ddot{\\theta} &amp;= f_{\\theta}(\\theta, \\dot{\\theta})             - m_p \\ddot{x} l \\cos \\theta - m_p g l \\sin \\theta \\\\     \\ddot{x}  &amp;= u, \\quad u \\in [-a, a]. \\end{align} \\] <p>But for practice it's more convenient to use another form</p> \\[ \\begin{align*}     \\left(m_p l^2 + I_p\\right) \\ddot{\\theta} &amp;= -\\mu\\dot{\\theta} - m_p \\ddot{x} l \\cos \\theta - m_p g l \\sin \\theta \\\\     \\ddot{\\theta} &amp;= -\\frac{\\mu}{\\left(m_p l^2 + I_p\\right)}\\dot{\\theta}             - \\frac{\\ddot{x} \\cos \\theta - g \\sin \\theta}{l + \\frac{I_p}{m_p l}}. \\\\ \\end{align*} \\] <p>Since all parameters do not change over time, we can greatly simplify the motion equations.</p> <p>Motion equations</p> \\[ \\begin{align}     \\ddot{\\theta} &amp;= -b\\dot{\\theta} - k \\big(\\ddot{x} \\cos \\theta - g \\sin \\theta\\big) \\\\     \\ddot{x} &amp;= u, \\quad u \\in [-a, a]. \\end{align} \\]"}]}